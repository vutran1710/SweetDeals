- type: serial
  steps:
    - name: testing
      exclude: master
      service: sweetdeals
      command: npm run verify
    - name: publish new docker image
      tag: master
      service: sweetdeals
      type: push
      image_name: vutrio/sweetdeals-image-demo
      image_tag: "{{ .CommitID }}"
      encrypted_dockercfg_path: dockercfg.encrypted
    - name: deploy app
      tag: master
      service: kubectl
      command: "kubectl rollout app-controller --image=vutrio/sweetdeals-image-demo:{{ .CommitID }}"
