- type: serial
  steps:
    - name: testing
      exclude: master
      service: testapp
      command: npm run verify
    - name: publish new docker image
      tag: master
      service: sweetdeals
      encrypted_dockercfg_path: dockercfg.encrypted
      command: "npm run prod && docker build -f Dockerfile.prod -t $CI_COMMIT_ID && docker push vutrio/sweetdeals-image-demo:$CI_COMMIT_ID"
    - name: set image app
      tag: master
      service: kubectl
      command: bash -c "kubectl set image deployment/my-app my-app=vutrio/sweetdeals-image-demo:$CI_COMMIT_ID && kubectl rollout status deployment/my-app"
